<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Flight Booking – Overbooking Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
        :root {
            --primary: #2563eb;
            --danger: #dc2626;
            --success: #16a34a;
            --bg: #0f172a;
            --card: #020617;
            --text: #e5e7eb;
            --muted: #94a3b8;
            --border: #1e293b;
        }

        * {
            box-sizing: border-box;
            font-family: Inter, system-ui, sans-serif;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #020617, #020617);
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            padding: 24px;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, .6);
        }

        h1 {
            margin: 0 0 8px;
            font-size: 28px;
            font-weight: 700;
        }

        .subtitle {
            color: var(--muted);
            margin-bottom: 24px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .section {
            border: 1px dashed var(--border);
            border-radius: 12px;
            padding: 16px;
        }

        .section h3 {
            margin: 0 0 12px;
            font-size: 18px;
        }

        input {
            width: 100%;
            padding: 12px;
            background: #020617;
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            margin-bottom: 12px;
        }

        input::placeholder {
            color: var(--muted);
        }

        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: transform .15s ease, opacity .15s ease;
        }

        button:hover {
            transform: translateY(-1px);
            opacity: .9;
        }

        .btn-unsafe {
            background: var(--danger);
            color: white;
        }

        .btn-safe {
            background: var(--success);
            color: white;
        }

        .btn-reset {
            background: var(--primary);
            color: white;
            margin-top: 12px;
            width: 100%;
        }

        .state {
            background: #020617;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            font-size: 14px;
            white-space: pre-wrap;
            min-height: 200px;
        }

        .badge {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .badge.flight {
            background: #1e40af;
            color: #bfdbfe;
        }

        footer {
            text-align: center;
            margin-top: 16px;
            font-size: 12px;
            color: var(--muted);
        }

        @media (max-width: 700px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <span class="badge flight">✈️ IST → Namangan</span>
        <h1>Booking System Overbooking Demo</h1>
        <p class="subtitle">
            Demonstrating <b>Race Condition</b> and <b>Critical Section Protection</b>
        </p>

        <div class="grid">
            <!-- Booking panel -->
            <div class="section">
                <h3>Passenger Booking</h3>

                <input id="name" placeholder="Passenger name"/>

                <div class="buttons">
                    <button class="btn-unsafe" onclick="book('unsafe')">
                        Book (UNSAFE)
                    </button>
                    <button class="btn-safe" onclick="book('safe')">
                        Book (SAFE)
                    </button>
                </div>

                <button class="btn-reset" onclick="resetSeats()">
                    Reset seats to 1
                </button>
            </div>

            <!-- State panel -->
            <div class="section">
                <h3>System State</h3>
                <div id="state" class="state">Loading...</div>
            </div>
        </div>

        <footer>
            OS – Critical Section • Producer / Consumer • Mutex Lock
        </footer>
    </div>
</div>

<script>
    const BASE = "http://127.0.0.1:8000";

    async function loadState() {
        const r = await fetch(`${BASE}/state`);
        const data = await r.json();
        document.getElementById("state").textContent =
            JSON.stringify(data, null, 2);
    }

    async function resetSeats() {
        await fetch(`${BASE}/reset?seats=1`, {method: "POST"});
        loadState();
    }

    async function book(mode) {
        const nameInput = document.getElementById("name");
        const name =
            nameInput.value ||
            "Passenger_" + Math.random().toString(16).slice(2, 6);

        await fetch(`${BASE}/book/${mode}`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({passenger_name: name})
        });

        nameInput.value = "";
        loadState();
    }

    loadState();
</script>

</body>
</html>
